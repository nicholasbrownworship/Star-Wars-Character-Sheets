<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>FFG Star Wars — Character Tracker</title>
  <style>
    :root{
      --bg:#0b1020; --panel:#0f1724; --accent:#b38b59; --muted:#98a0b3; --glass: rgba(255,255,255,0.03);
      --danger:#c9544a; --good:#59a96a;
      font-family: Inter, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
    }
    *{box-sizing:border-box}
    html,body{height:100%;margin:0;background:linear-gradient(180deg,#071021 0%, #081323 60%);color:#e6eef8}
    .app{display:grid;grid-template-columns:300px 1fr;gap:18px;height:100vh;padding:18px}
    .panel{background:var(--panel);border-radius:12px;padding:14px;box-shadow:0 6px 20px rgba(2,6,23,0.6);}
    header{display:flex;align-items:center;gap:12px}
    header h1{margin:0;font-size:16px}
    .character-list{overflow:auto;margin-top:12px;max-height:calc(100vh - 160px)}
    .char-item{display:flex;justify-content:space-between;align-items:center;padding:8px;border-radius:8px;background:var(--glass);margin-bottom:8px;cursor:pointer}
    .char-item.active{outline:2px solid rgba(179,139,89,0.18)}
    button{background:transparent;border:1px solid rgba(255,255,255,0.06);padding:8px 10px;border-radius:8px;color:inherit;cursor:pointer}
    .controls{display:flex;gap:8px;flex-wrap:wrap;margin-top:12px}
    .editor{padding:18px;display:flex;flex-direction:column;gap:12px;height:100%;overflow:auto}
    .row{display:flex;gap:12px}
    .col{flex:1}
    label{font-size:12px;color:var(--muted);display:block;margin-bottom:6px}
    input[type=text], select, textarea{width:100%;padding:8px;border-radius:8px;border:1px solid rgba(255,255,255,0.04);background:rgba(0,0,0,0.2);color:inherit}
    .stat-grid{display:grid;grid-template-columns:repeat(6,1fr);gap:10px}
    .stat{background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));padding:8px;border-radius:8px;text-align:center}
    .stat b{display:block;font-size:18px}
    .skills{display:flex;flex-direction:column;gap:6px}
    .skill{display:flex;justify-content:space-between;align-items:center;padding:8px;background:var(--glass);border-radius:8px}
    .footer-actions{display:flex;gap:10px;flex-wrap:wrap}
    .import-input{display:none}
    .meta{font-size:12px;color:var(--muted)}
    .big{font-size:20px}
    @media (max-width:880px){.app{grid-template-columns:1fr;grid-auto-rows:auto}.character-list{max-height:240px}}
  </style>
</head>
<body>
  <div class="app">
    <aside class="panel">
      <header>
        <div style="width:48px;height:48px;border-radius:8px;background:linear-gradient(135deg,var(--accent),#8a6b44);display:flex;align-items:center;justify-content:center;font-weight:700">SW</div>
        <div>
          <h1>FFG Character Tracker</h1>
          <div class="meta">Local-only · saves to browser · export/import JSON</div>
        </div>
      </header>

      <div class="controls">
        <button id="newBtn">New Character</button>
        <button id="duplicateBtn">Duplicate</button>
        <button id="deleteBtn">Delete</button>
        <button id="exportBtn">Export</button>
        <button id="importBtn">Import</button>
        <input type="file" id="importFile" class="import-input" accept="application/json" />
      </div>

      <div class="character-list" id="charList" aria-label="Characters"></div>

      <div style="margin-top:12px;border-top:1px solid rgba(255,255,255,0.02);padding-top:12px">
        <div class="meta">Quick actions</div>
        <div style="margin-top:8px;display:flex;gap:8px">
          <button id="seedBtn">Load Sample</button>
          <button id="clearAllBtn">Clear All</button>
        </div>
      </div>
    </aside>

    <main class="panel editor">
      <div style="display:flex;justify-content:space-between;align-items:center">
        <div>
          <div class="meta">Editing</div>
          <div id="charNameDisplay" class="big">— select a character —</div>
        </div>
        <div class="footer-actions">
          <button id="saveBtn">Save</button>
          <button id="downloadBtn">Download JSON</button>
        </div>
      </div>

      <div id="editorForm" style="display:none">
        <div class="row">
          <div class="col">
            <label>Name</label>
            <input id="name" type="text" placeholder="Character name" />
          </div>
          <div style="width:200px">
            <label>Species</label>
            <input id="species" type="text" placeholder="Human / Twi'lek" />
          </div>
          <div style="width:220px">
            <label>Career / Role</label>
            <input id="career" type="text" placeholder="Smuggler / Bounty Hunter" />
          </div>
        </div>

        <div>
          <label>Motivation / Notes</label>
          <textarea id="notes" rows="3"></textarea>
        </div>

        <div>
          <label>Characteristics</label>
          <div class="stat-grid" id="stats">
            <!-- dynamic -->
          </div>
        </div>

        <div style="display:flex;gap:12px">
          <div style="flex:1">
            <label>Wounds</label>
            <input id="wounds" type="number" min="0" />
          </div>
          <div style="width:140px">
            <label>Strain</label>
            <input id="strain" type="number" min="0" />
          </div>
          <div style="width:140px">
            <label>Soak</label>
            <input id="soak" type="number" min="0" />
          </div>
          <div style="width:140px">
            <label>Defense</label>
            <input id="defense" type="number" min="0" />
          </div>
        </div>

        <div>
          <label>Skills</label>
          <div class="skills" id="skillList"></div>
          <div style="display:flex;gap:8px;margin-top:8px">
            <input id="newSkillName" type="text" placeholder="Skill name" />
            <input id="newSkillRank" type="number" min="0" value="0" style="width:80px" />
            <button id="addSkillBtn">Add Skill</button>
          </div>
        </div>

        <div>
          <label>Inventory / Gear</label>
          <textarea id="gear" rows="3" placeholder="Blaster pistol, Vibroknife, Datapad..."></textarea>
        </div>

        <div style="display:flex;gap:8px">
          <button id="rollCheckBtn">Roll Check (simulated)</button>
          <button id="gainXpBtn">+5 XP</button>
          <div class="meta" style="margin-left:auto">XP: <span id="xp">0</span></div>
        </div>

      </div>

      <div id="emptyState" style="margin-top:24px">No character selected. Pick one from the left or create a new character.</div>

    </main>
  </div>

  <script>
    // Simple FFG-style character tracker (local only)
    const STORAGE_KEY = 'ffg_sw_chars_v1';
    let chars = JSON.parse(localStorage.getItem(STORAGE_KEY) || '[]');
    let selectedId = null;

    const defaultStats = ['Brawn','Agility','Intellect','Cunning','Willpower','Presence'];

    // DOM
    const charList = document.getElementById('charList');
    const newBtn = document.getElementById('newBtn');
    const saveBtn = document.getElementById('saveBtn');
    const deleteBtn = document.getElementById('deleteBtn');
    const duplicateBtn = document.getElementById('duplicateBtn');
    const exportBtn = document.getElementById('exportBtn');
    const importBtn = document.getElementById('importBtn');
    const importFile = document.getElementById('importFile');
    const seedBtn = document.getElementById('seedBtn');
    const clearAllBtn = document.getElementById('clearAllBtn');
    const editorForm = document.getElementById('editorForm');
    const emptyState = document.getElementById('emptyState');
    const charNameDisplay = document.getElementById('charNameDisplay');
    const downloadBtn = document.getElementById('downloadBtn');

    // fields
    const nameFld = document.getElementById('name');
    const speciesFld = document.getElementById('species');
    const careerFld = document.getElementById('career');
    const notesFld = document.getElementById('notes');
    const xpDisplay = document.getElementById('xp');
    const woundsFld = document.getElementById('wounds');
    const strainFld = document.getElementById('strain');
    const soakFld = document.getElementById('soak');
    const defenseFld = document.getElementById('defense');
    const statsDiv = document.getElementById('stats');
    const skillList = document.getElementById('skillList');
    const newSkillName = document.getElementById('newSkillName');
    const newSkillRank = document.getElementById('newSkillRank');

    // build stats inputs
    function buildStatsInputs(values={}){
      statsDiv.innerHTML='';
      for(const s of defaultStats){
        const val = values[s] ?? 1;
        const el = document.createElement('div');
        el.className='stat';
        el.innerHTML = `<div class="meta">${s}</div><b><input type="number" data-stat="${s}" min="0" value="${val}" style="width:46px;background:transparent;border:0;color:inherit;text-align:center;font-size:18px"/></b>`;
        statsDiv.appendChild(el);
      }
    }

    buildStatsInputs();

    function saveToStorage(){ localStorage.setItem(STORAGE_KEY, JSON.stringify(chars)); }

    function renderList(){
      charList.innerHTML='';
      for(const c of chars){
        const el = document.createElement('div');
        el.className='char-item' + (c.id===selectedId ? ' active' : '');
        el.innerHTML = `<div><strong>${c.name||'Unnamed'}</strong><div class="meta">${c.career||''} · XP ${c.xp||0}</div></div><div class="meta">${c.species||''}</div>`;
        el.addEventListener('click',()=>{ selectCharacter(c.id); });
        charList.appendChild(el);
      }
    }

    function uid(){ return 'id_'+Math.random().toString(36).slice(2,9); }

    function newCharacter(){
      const c = {
        id: uid(), name:'New Character', species:'Human', career:'Unknown', notes:'', xp:0,
        wounds:0,strain:0,soak:0,defense:0,
        stats: {Brawn:2,Agility:2,Intellect:2,Cunning:2,Willpower:2,Presence:2},
        skills:[], gear:'', created:Date.now()
      };
      chars.unshift(c); selectedId = c.id; saveToStorage(); renderList(); renderEditor();
    }

    function selectCharacter(id){ selectedId = id; renderList(); renderEditor(); }

    function getSelected(){ return chars.find(c=>c.id===selectedId); }

    function renderEditor(){
      const s = getSelected();
      if(!s){ editorForm.style.display='none'; emptyState.style.display='block'; charNameDisplay.textContent='— select a character —'; return; }
      editorForm.style.display='block'; emptyState.style.display='none';
      charNameDisplay.textContent = s.name || 'Unnamed';
      nameFld.value=s.name; speciesFld.value=s.species; careerFld.value=s.career; notesFld.value=s.notes||'';
      xpDisplay.textContent = s.xp||0;
      woundsFld.value = s.wounds||0; strainFld.value = s.strain||0; soakFld.value = s.soak||0; defenseFld.value = s.defense||0;
      buildStatsInputs(s.stats);
      renderSkills(s.skills);
    }

    function renderSkills(arr){ skillList.innerHTML=''; for(let i=0;i<arr.length;i++){ const sk=arr[i]; const el=document.createElement('div'); el.className='skill'; el.innerHTML=`<div>${sk.name}</div><div style="display:flex;gap:8px;align-items:center"><input type="number" data-idx="${i}" value="${sk.rank}" style="width:60px"/><button data-del="${i}">Del</button></div>`; skillList.appendChild(el); }
      // bind
      skillList.querySelectorAll('input[type=number]').forEach(n=>n.addEventListener('change',e=>{ const idx=+e.target.dataset.idx; const v=+e.target.value; const s=getSelected(); if(s){ s.skills[idx].rank=v; saveToStorage(); renderList(); renderEditor(); }}));
      skillList.querySelectorAll('button[data-del]').forEach(b=>b.addEventListener('click',e=>{ const idx=+e.target.dataset.del; const s=getSelected(); if(!s) return; s.skills.splice(idx,1); saveToStorage(); renderList(); renderEditor(); }));
    }

    // UI actions
    newBtn.addEventListener('click',()=>{ newCharacter(); });
    saveBtn.addEventListener('click',()=>{ const s=getSelected(); if(!s) return; s.name=nameFld.value; s.species=speciesFld.value; s.career=careerFld.value; s.notes=notesFld.value; s.wounds=+woundsFld.value||0; s.strain=+strainFld.value||0; s.soak=+soakFld.value||0; s.defense=+defenseFld.value||0; s.stats={}; statsDiv.querySelectorAll('input[data-stat]').forEach(i=>s.stats[i.dataset.stat]=+i.value||0); saveToStorage(); renderList(); renderEditor(); alert('Saved'); });

    deleteBtn.addEventListener('click',()=>{ if(!selectedId) return alert('No character selected'); if(!confirm('Delete this character?')) return; chars = chars.filter(c=>c.id!==selectedId); selectedId = chars[0]?.id || null; saveToStorage(); renderList(); renderEditor(); });

    duplicateBtn.addEventListener('click',()=>{ const s=getSelected(); if(!s) return alert('Select a character'); const copy = JSON.parse(JSON.stringify(s)); copy.id=uid(); copy.name = copy.name + ' (copy)'; chars.unshift(copy); selectedId = copy.id; saveToStorage(); renderList(); renderEditor(); });

    exportBtn.addEventListener('click',()=>{ const data = JSON.stringify(chars,null,2); const blob = new Blob([data],{type:'application/json'}); const url = URL.createObjectURL(blob); const a=document.createElement('a'); a.href=url; a.download='ffg_sw_characters.json'; a.click(); URL.revokeObjectURL(url); });

    importBtn.addEventListener('click',()=> importFile.click());
    importFile.addEventListener('change',async(e)=>{
      const f = e.target.files[0]; if(!f) return; try{ const txt = await f.text(); const imported = JSON.parse(txt); if(!Array.isArray(imported)) return alert('Invalid file'); // merge
        for(const it of imported){ if(!it.id) it.id=uid(); chars.unshift(it); }
        saveToStorage(); renderList(); renderEditor(); alert('Imported '+imported.length+' characters');
      }catch(err){ alert('Import failed: '+err.message) }
      importFile.value='';
    });

    seedBtn.addEventListener('click',()=>{
      const sample = {
        id:uid(), name:'Eren Valos', species:"Human", career:'Smuggler', notes:'Quick with a blaster and quicker with a lie.', xp:25,
        wounds:2,strain:1,soak:1,defense:1,
        stats:{Brawn:2,Agility:3,Intellect:2,Cunning:3,Willpower:2,Presence:2},
        skills:[{name:'Piloting',rank:2},{name:'Piloting (Space)',rank:1},{name:'Skulduggery',rank:2},{name:'Blaster',rank:3}], gear:'Light Blaster Pistol, Datapad, 2x Medpatch', created:Date.now()
      };
      chars.unshift(sample);
      saveToStorage(); renderList(); renderEditor();
    });

    clearAllBtn.addEventListener('click',()=>{ if(!confirm('Clear all characters from storage?')) return; chars=[]; selectedId=null; saveToStorage(); renderList(); renderEditor(); });

    document.getElementById('addSkillBtn').addEventListener('click',()=>{
      const s = getSelected(); if(!s) return alert('Select a character'); const name = newSkillName.value.trim(); const rank = Math.max(0, +newSkillRank.value || 0); if(!name) return alert('Provide a skill name'); s.skills.push({name,rank}); newSkillName.value=''; newSkillRank.value='0'; saveToStorage(); renderList(); renderEditor(); });

    document.getElementById('rollCheckBtn').addEventListener('click',()=>{
      // simulated 'roll' — we won't implement full FFG dice, but give a nice random result for checks
      const s = getSelected(); if(!s) return alert('Select a character'); const statInputs = Array.from(statsDiv.querySelectorAll('input[data-stat]')).map(i=>+i.value||0); const statTotal = statInputs.reduce((a,b)=>a+b,0); const skillTotal = s.skills.reduce((a,b)=>a.rank+a,0); const roll = Math.floor(Math.random()*20)+1; const total = roll + Math.floor(statTotal/6) + Math.floor(skillTotal/4);
      alert(`Check result: d20(${roll}) + bonuses = ${total} (approx.)`);
    });

    document.getElementById('gainXpBtn').addEventListener('click',()=>{ const s=getSelected(); if(!s) return; s.xp = (s.xp||0)+5; saveToStorage(); renderList(); renderEditor(); });

    downloadBtn.addEventListener('click',()=>{
      const s = getSelected(); if(!s) return alert('Select a character'); const data = JSON.stringify(s,null,2); const blob = new Blob([data],{type:'application/json'}); const url = URL.createObjectURL(blob); const a=document.createElement('a'); a.href=url; a.download=(s.name||'character')+'.json'; a.click(); URL.revokeObjectURL(url);
    });

    // initial render
    if(chars.length>0){ selectedId = chars[0].id; }
    renderList(); renderEditor();

    // keyboard shortcuts (optional)
    document.addEventListener('keydown',(e)=>{
      if(e.ctrlKey && e.key==='n'){ e.preventDefault(); newCharacter(); }
      if(e.ctrlKey && e.key==='s'){ e.preventDefault(); saveBtn.click(); }
    });

  </script>
  <div id="dice-roller">
  <h2>FFG Dice Roller</h2>
  <label>Ability (green): <input type="number" id="abilityDice" value="0" min="0"></label>
  <label>Proficiency (yellow): <input type="number" id="proficiencyDice" value="0" min="0"></label>
  <label>Difficulty (purple): <input type="number" id="difficultyDice" value="0" min="0"></label>
  <label>Challenge (red): <input type="number" id="challengeDice" value="0" min="0"></label>
  <label>Boost (blue): <input type="number" id="boostDice" value="0" min="0"></label>
  <label>Setback (black): <input type="number" id="setbackDice" value="0" min="0"></label>
  <label>Force (white): <input type="number" id="forceDice" value="0" min="0"></label>
  <button onclick="rollFFGDice()">Roll Dice</button>
  <pre id="diceResults"></pre>
</div>

<script>
// Dice symbol pools for FFG system
const DICE = {
  ability: [["S"],["S"],["A"],["A"],["S","A"],["S"],["A"],[]],
  proficiency: [["S"],["S"],["S","S"],["A"],["A"],["A","A"],["S","A"],["S","A"],["T"],["S"],["A"],[]],
  difficulty: [["F"],["F"],["T"],["T"],["F","T"],["F"],["T"],[]],
  challenge: [["F"],["F"],["F","F"],["T"],["T"],["T","T"],["F","T"],["F","T"],["D"],["F"],["T"],[]],
  boost: [["S"],["A"],["S","A"],["A","A"],[],[]],
  setback: [["F"],["F"],["T"],["T"],[],[]],
  force: [["L"],["L"],["L"],["L"],["L","L"],["D"],["D"],["D"],["D"],["D"],["D","D"],[]]
};

// Helper to roll one die
function rollDie(type) {
  const sides = DICE[type];
  const result = sides[Math.floor(Math.random() * sides.length)];
  return result;
}

// Roll multiple dice
function rollFFGDice() {
  const counts = {
    ability: +document.getElementById("abilityDice").value,
    proficiency: +document.getElementById("proficiencyDice").value,
    difficulty: +document.getElementById("difficultyDice").value,
    challenge: +document.getElementById("challengeDice").value,
    boost: +document.getElementById("boostDice").value,
    setback: +document.getElementById("setbackDice").value,
    force: +document.getElementById("forceDice").value
  };

  const tally = {S:0,F:0,A:0,T:0,Tm:0,Dp:0,L:0,D:0}; // Triumph, Despair, Light, Dark
  let details = [];

  for (let type in counts) {
    for (let i=0;i<counts[type];i++) {
      const result = rollDie(type);
      details.push(type + ": " + (result.length ? result.join(",") : "blank"));
      for (let sym of result) {
        if (sym==="T") tally.T++;
        else if (sym==="S") tally.S++;
        else if (sym==="F") tally.F++;
        else if (sym==="A") tally.A++;
        else if (sym==="D") tally.D++;
        else if (sym==="L") tally.L++;
        else if (sym==="Tm") tally.Tm++;
        else if (sym==="Dp") tally.Dp++;
        else if (sym==="T") tally.T++;
        else if (sym==="D") tally.D++;
        else if (sym==="T") tally.T++;
        else if (sym==="D") tally.D++;
      }
    }
  }

  // Net results
  const netSuccess = tally.S - tally.F;
  const netAdvantage = tally.A - tally.T;

  let output = "Rolls:\n" + details.join("\n") + "\n\n";
  output += `Net Results: ${netSuccess} Success, ${netAdvantage} Advantage\n`;
  if (tally.Tm) output += `Triumph: ${tally.Tm}\n`;
  if (tally.Dp) output += `Despair: ${tally.Dp}\n`;
  if (tally.L || tally.D) output += `Force: ${tally.L} Light / ${tally.D} Dark\n`;

  document.getElementById("diceResults").textContent = output;
}
</script>

</body>
</html>
