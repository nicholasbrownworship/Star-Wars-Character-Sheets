<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>FFG Star Wars Character Tracker</title>
<style>
body { font-family: Arial, sans-serif; background:#111; color:#eee; }
.container { display:flex; }
.sidebar { width:200px; background:#222; padding:10px; }
.main { flex:1; padding:10px; }
button { margin:2px; }
.char-list button { display:block; width:100%; margin:2px 0; }
.skill-dice img { width:16px; height:16px; margin:0 1px; }
.dice-result img { width:36px; height:36px; margin:2px; }
.results-box { background:#222; padding:6px; margin-top:6px; }
</style>
</head>
<body>
<div class="container">
  <div class="sidebar">
    <h3>Characters</h3>
    <div id="charList" class="char-list"></div>
    <button id="newBtn">New</button>
    <button id="duplicateBtn">Duplicate</button>
    <button id="deleteBtn">Delete</button>
    <button id="saveBtn">Save</button>
    <button id="exportBtn">Export</button>
    <button id="importBtn">Import</button>
    <input type="file" id="importFile" style="display:none">
    <button id="seedBtn">Seed Example</button>
    <button id="clearAllBtn">Clear All</button>
    <button id="printBtn">Print</button>
  </div>
  <div class="main">
    <h2 id="charName">No Character</h2>
    <div>
      <label>Name <input id="nameInput"></label><br>
      <label>Species <input id="speciesInput"></label><br>
      <label>Career <input id="careerInput"></label>
    </div>
    <h3>Stats</h3>
    <div id="stats"></div>
    <h3>Skills</h3>
    <div id="skills"></div>

    <h3>Dice Roller</h3>
    <div class="dice-controls">
      <label>Ability <input type="number" min="0" id="diceAbility"></label>
      <label>Proficiency <input type="number" min="0" id="diceProficiency"></label>
      <label>Boost <input type="number" min="0" id="diceBoost"></label>
      <label>Difficulty <input type="number" min="0" id="diceDifficulty"></label>
      <label>Challenge <input type="number" min="0" id="diceChallenge"></label>
      <label>Setback <input type="number" min="0" id="diceSetback"></label>
      <label>Force 1 <input type="number" min="0" id="diceForce1"></label>
      <label>Force 2 <input type="number" min="0" id="diceForce2"></label>
    </div>
    <div style="margin-top:6px">
      <button id="rollDiceBtn">Roll</button>
      <button id="clearDiceBtn">Clear</button>
    </div>
    <div class="dice-result" id="diceResult"></div>
    <div class="results-box" id="diceTotals">Results will appear here...</div>
  </div>
</div>

<script>
// --- Dice faces ---
const diceFaces = {
  ability: [
    {img:"green_blank.jpg",success:0,adv:0},
    {img:"green_success.jpg",success:1,adv:0},
    {img:"green_success_success.jpg",success:2,adv:0},
    {img:"green_success_adv.jpg",success:1,adv:1},
    {img:"green_advantage.jpg",success:0,adv:1},
    {img:"green_advantage_advantage.jpg",success:0,adv:2}
  ],
  proficiency: [
    {img:"yellow_blank.jpg",success:0,adv:0},
    {img:"yellow_success.jpg",success:1,adv:0},
    {img:"yellow_success_adv.jpg",success:1,adv:1},
    {img:"yellow_success_success.jpg",success:2,adv:0},
    {img:"yellow_advantage.jpg",success:0,adv:1},
    {img:"yellow_advantage_advantage.jpg",success:0,adv:2},
    {img:"yellow_triumph.jpg",success:1,adv:0,triumph:1}
  ],
  boost: [
    {img:"blue_blank.jpg",success:0,adv:0},
    {img:"blue_success.jpg",success:1,adv:0},
    {img:"blue_success_adv.jpg",success:1,adv:1},
    {img:"blue_advantage.jpg",success:0,adv:1},
    {img:"blue_advantage_advantage.jpg",success:0,adv:2}
  ],
  difficulty: [
    {img:"purple_blank.jpg",failure:0,threat:0},
    {img:"purple_failure.jpg",failure:1,threat:0},
    {img:"purple_failure_failure.jpg",failure:2,threat:0},
    {img:"purple_failure_threat.jpg",failure:1,threat:1},
    {img:"purple_threat.jpg",failure:0,threat:1},
    {img:"purple_threat_threat.jpg",failure:0,threat:2}
  ],
  challenge: [
    {img:"red_blank.jpg",failure:0,threat:0},
    {img:"red_failure.jpg",failure:1,threat:0},
    {img:"red_failure_failure.jpg",failure:2,threat:0},
    {img:"red_failure_threat.jpg",failure:1,threat:1},
    {img:"red_threat.jpg",failure:0,threat:1},
    {img:"red_threat_threat.jpg",failure:0,threat:2},
    {img:"red_despair.jpg",failure:1,threat:0,despair:1}
  ],
  setback: [
    {img:"black_blank.jpg",failure:0,threat:0},
    {img:"black_failure.jpg",failure:1,threat:0},
    {img:"black_threat.jpg",failure:0,threat:1}
  ],
  force: [
    {img:"white_dark.jpg",dark:1,light:0},
    {img:"white_dark.jpg",dark:2,light:0},
    {img:"white_light.jpg",dark:0,light:1},
    {img:"white_light_light.jpg",dark:0,light:2}
  ]
};

// --- Dice rolling ---
function rollDie(type){
  const faces=diceFaces[type];
  return faces[Math.floor(Math.random()*faces.length)];
}

document.getElementById("rollDiceBtn").onclick=()=>{
  const container=document.getElementById("diceResult");
  container.innerHTML="";
  let totals={success:0,adv:0,failure:0,threat:0,triumph:0,despair:0,light:0,dark:0};

  const diceTypes=["Ability","Proficiency","Boost","Difficulty","Challenge","Setback","Force1","Force2"];
  diceTypes.forEach(type=>{
    const n=parseInt(document.getElementById("dice"+type).value)||0;
    const diceType=type.toLowerCase().replace("1","").replace("2","");
    for(let i=0;i<n;i++){
      const res=rollDie(diceType);
      const img=document.createElement("img");
      img.src="dice/"+res.img;
      container.appendChild(img);
      for(let key in res){ if(key!=="img") totals[key]=(totals[key]||0)+res[key]; }
    }
  });

  // Resolve cancellations
  const netSuccess = (totals.success||0) - (totals.failure||0);
  const netAdv = (totals.adv||0) - (totals.threat||0);

  document.getElementById("diceTotals").innerHTML=
    `<b>Results:</b><br>
    Success: ${netSuccess} <br>
    Advantage: ${netAdv} <br>
    Triumph: ${totals.triumph||0} <br>
    Despair: ${totals.despair||0} <br>
    Light: ${totals.light||0} <br>
    Dark: ${totals.dark||0}`;
};

document.getElementById("clearDiceBtn").onclick=()=>{
  document.getElementById("diceResult").innerHTML="";
  document.getElementById("diceTotals").innerHTML="Results will appear here...";
};

// === Character logic is unchanged from last working version ===
let characters=[],selectedIndex=null;
function refreshCharList(){const list=document.getElementById("charList"); list.innerHTML=""; characters.forEach((c,i)=>{const b=document.createElement("button"); b.textContent=c.name; b.onclick=()=>openCharacter(i); list.appendChild(b);});}
function openCharacter(i){selectedIndex=i; const c=characters[i]; document.getElementById("charName").textContent=c.name; document.getElementById("nameInput").value=c.name; document.getElementById("speciesInput").value=c.species; document.getElementById("careerInput").value=c.career;}
function saveCharacter(){if(selectedIndex===null)return; const c=characters[selectedIndex]; c.name=document.getElementById("nameInput").value; c.species=document.getElementById("speciesInput").value; c.career=document.getElementById("careerInput").value; refreshCharList();}
function saveToStorage(){localStorage.setItem("swChars",JSON.stringify(characters));}
function loadFromStorage(){const d=localStorage.getItem("swChars"); if(d)characters=JSON.parse(d);}
document.getElementById("newBtn").onclick=()=>{characters.push({name:"New Character",species:"",career:""}); selectedIndex=characters.length-1; openCharacter(selectedIndex); saveToStorage();};
document.getElementById("duplicateBtn").onclick=()=>{if(selectedIndex===null)return; const copy=JSON.parse(JSON.stringify(characters[selectedIndex])); copy.name+=" Copy"; characters.push(copy); selectedIndex=characters.length-1; openCharacter(selectedIndex); saveToStorage();};
document.getElementById("deleteBtn").onclick=()=>{if(selectedIndex===null)return; characters.splice(selectedIndex,1); selectedIndex=null; refreshCharList(); saveToStorage();};
document.getElementById("saveBtn").onclick=saveCharacter;
document.getElementById("exportBtn").onclick=()=>{const a=document.createElement("a"); a.href=URL.createObjectURL(new Blob([JSON.stringify(characters,null,2)],{type:"application/json"})); a.download="characters.json"; a.click();}
document.getElementById("importBtn").onclick=()=>document.getElementById("importFile").click();
document.getElementById("importFile").onchange=e=>{const file=e.target.files[0]; const reader=new FileReader(); reader.onload=function(){characters=JSON.parse(reader.result); refreshCharList(); saveToStorage();}; reader.readAsText(file);};
document.getElementById("seedBtn").onclick=()=>{characters=[{name:"Luke Skywalker",species:"Human",career:"Jedi"}]; selectedIndex=0; openCharacter(0); saveToStorage();};
document.getElementById("clearAllBtn").onclick=()=>{characters=[]; selectedIndex=null; refreshCharList(); saveToStorage();};
document.getElementById("printBtn").onclick=()=>{if(selectedIndex===null)return; const c=characters[selectedIndex]; document.getElementById("printName").textContent=c.name; window.print();};
loadFromStorage(); refreshCharList(); if(characters.length>0){selectedIndex=0; openCharacter(0);}
</script>
</body>
</html>
