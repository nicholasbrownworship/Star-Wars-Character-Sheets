<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>FFG Star Wars Character Tracker</title>
<link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&family=Inter:wght@300;400;600&display=swap" rel="stylesheet">
<style>
:root{
  --bg-overlay: rgba(2,6,12,0.55);
  --panel: rgba(10,18,28,0.72);
  --accent:#44d7ff;
  --muted:#98a0b3;
  --glass: rgba(255,255,255,0.03);
  font-family: 'Inter', system-ui, -apple-system, 'Segoe UI', Roboto, 'Helvetica Neue', Arial;
}
html,body{height:100%;margin:0}
body{
  background: url('4107909.jpg') no-repeat center center fixed;
  background-size: cover;
  color:#e6eef8;
  min-height:100vh;
}
body::before{
  content:""; position:fixed; inset:0;
  background:linear-gradient(180deg, rgba(0,0,0,0.45), rgba(0,0,0,0.65));
  z-index:-1;
}
.app{display:grid;grid-template-columns:320px 1fr;gap:18px;height:100vh;padding:20px;align-items:start}
.panel{background:var(--panel);border-radius:12px;padding:14px;box-shadow:0 10px 40px rgba(3,10,18,0.75);border:1px solid rgba(68,215,255,0.08)}
aside.panel{height:calc(100vh - 40px);overflow:auto}
main.panel{height:calc(100vh - 40px);overflow:auto;position:relative}
.datapad{background:linear-gradient(180deg, rgba(6,24,36,0.86), rgba(8,16,28,0.6));border:1px solid rgba(68,215,255,0.06);box-shadow:0 6px 30px rgba(0,120,160,0.12);border-radius:16px;padding:18px}
header{display:flex;gap:12px;align-items:center}
header .logo{width:52px;height:52px;border-radius:8px;background:linear-gradient(135deg,var(--accent),#8a6b44);display:flex;align-items:center;justify-content:center;font-weight:700;font-family:'Orbitron',sans-serif;color:#021;box-shadow:0 6px 18px rgba(68,215,255,0.06)}
h1{margin:0;font-size:16px}
.meta{font-size:12px;color:var(--muted)}
.character-list{margin-top:12px}
.char-item{display:flex;justify-content:space-between;align-items:center;padding:10px;border-radius:10px;background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));margin-bottom:8px;cursor:pointer;transition:all 0.2s}
.char-item:hover{background:linear-gradient(180deg, rgba(255,255,255,0.04), rgba(255,255,255,0.02));transform:scale(1.02)}
.char-item.active{outline:2px solid rgba(68,215,255,0.08)}
.editor{display:flex;flex-direction:column;gap:12px}
.row{display:flex;gap:12px}
.col{flex:1}
label{font-size:12px;color:var(--muted);display:block;margin-bottom:6px}
input[type=text], input[type=number], select, textarea{width:100%;padding:8px;border-radius:8px;border:1px solid rgba(255,255,255,0.04);background:rgba(0,0,0,0.22);color:inherit}
textarea{resize:vertical}
.stat-grid{display:grid;grid-template-columns:repeat(6,1fr);gap:8px;margin-top:8px}
.stat{padding:8px;border-radius:8px;background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));text-align:center}
.stat input{width:56px;text-align:center;font-size:16px;background:transparent;border:0;color:inherit}
.skills{display:flex;flex-direction:column;gap:6px;max-height:400px;overflow-y:auto}
.skill{display:flex;justify-content:space-between;align-items:center;padding:6px;border-radius:8px;background:var(--glass)}
.skill .skillDice{display:flex;gap:4px;flex-wrap:wrap}
.dice-dot{width:12px;height:12px;border-radius:50%;}
.dice-dot.ability{background:#00ff66;}
.dice-dot.proficiency{background:#ffe600;}
.dice-roller{margin-top:8px;padding:12px;background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));border-radius:8px}
.dice-controls{display:grid;grid-template-columns:repeat(7,1fr);gap:6px}
.dice-controls label{display:flex;flex-direction:column;align-items:center;font-size:12px}
.dice-result{background:rgba(0,0,0,0.25);padding:10px;border-radius:8px;min-height:48px;display:flex;flex-wrap:wrap;gap:2px;align-items:center}
.actions{display:flex;gap:8px;flex-wrap:wrap}
button{background:transparent;border:1px solid rgba(255,255,255,0.06);padding:6px 10px;border-radius:8px;color:inherit;cursor:pointer;transition:all 0.2s}
button:hover{background:rgba(68,215,255,0.08)}
.net-positive{color:#4fff4f;font-weight:700}
.net-negative{color:#ff4f4f;font-weight:700}
.net-neutral{color:#ffffff;font-weight:700}
</style>
</head>
<body>
<div class="app">
<aside class="panel datapad">
<header>
<div class="logo">SW</div>
<div><h1>FFG Character Tracker</h1><div class="meta">Local-only · export/import JSON · printable</div></div>
</header>

<div class="controls" style="margin-top:12px">
<button id="newBtn">New</button>
<button id="duplicateBtn">Duplicate</button>
<button id="deleteBtn">Delete</button>
<button id="exportBtn">Export</button>
<button id="importBtn">Import</button>
<input id="importFile" type="file" accept="application/json" style="display:none" />
</div>

<div class="character-list" id="charList"></div>

<div style="margin-top:12px;border-top:1px solid rgba(255,255,255,0.03);padding-top:12px">
<div class="meta">Quick actions</div>
<div style="margin-top:8px;display:flex;gap:8px;flex-wrap:wrap">
<button id="seedBtn">Load Sample</button>
<button id="clearAllBtn">Clear All</button>
<button id="printBtn">Print Sheet</button>
</div>
</div>
</aside>

<main class="panel datapad">
<div style="display:flex;justify-content:space-between;align-items:center">
<div><div class="meta">Editing</div><div id="charNameDisplay" style="font-size:20px">— select a character —</div></div>
<div class="actions"><button id="saveBtn">Save</button></div>
</div>

<div id="editorForm" style="display:none" class="editor">
<div class="row">
<div class="col"><label>Name</label><input id="name" type="text" /></div>
<div style="width:190px"><label>Species</label><input id="species" type="text" /></div>
<div style="width:220px"><label>Career / Role</label><input id="career" type="text" /></div>
</div>

<div><label>Motivation / Notes</label><textarea id="notes" rows="3"></textarea></div>
<div><label>Characteristics</label><div class="stat-grid" id="stats"></div></div>

<div style="display:flex;gap:12px">
<div style="flex:1"><label>Wounds</label><input id="wounds" type="number" min="0" /></div>
<div style="flex:1"><label>Strain</label><input id="strain" type="number" min="0" /></div>
<div style="flex:1"><label>Soak</label><input id="soak" type="number" min="0" /></div>
<div style="flex:1"><label>Defense</label><input id="defense" type="number" min="0" /></div>
</div>

<div><label>Gear / Equipment</label><input id="gear" type="text" /></div>
<div><label>Skills</label><div class="skills" id="skillList"></div></div>

<div class="dice-roller">
<label>Dice Roller</label>
<div class="dice-controls">
<label>Ability<input type="number" min="0" id="diceAbility"></label>
<label>Proficiency<input type="number" min="0" id="diceProficiency"></label>
<label>Boost<input type="number" min="0" id="diceBoost"></label>
<label>Difficulty<input type="number" min="0" id="diceDifficulty"></label>
<label>Challenge<input type="number" min="0" id="diceChallenge"></label>
<label>Setback<input type="number" min="0" id="diceSetback"></label>
<label>Force<input type="number" min="0" id="diceForce"></label>
</div>
<div style="margin-top:6px">
<button id="rollDiceBtn">Roll</button>
<button id="clearDiceBtn">Clear</button>
</div>
<div class="dice-result" id="diceResult"></div>
<div class="dice-result" id="netResult" style="margin-top:6px"></div>
</div>
</main>
</div>

<script>
const ALL_SKILLS=["Astrogation","Athletics","Brawl","Computers","Coordination","Cool","Deception","Discipline","Leadership","Mechanics","Medicine","Negotiation","Perception","Piloting (Planetary)","Piloting (Space)","Resilience","Skulduggery","Stealth","Streetwise","Survival","Vigilance","Lightsaber"];
const skillAttributes={
  "Brawn":["Athletics","Brawl","Resilience"],
  "Agility":["Piloting (Planetary)","Piloting (Space)","Coordination","Stealth"],
  "Intellect":["Computers","Mechanics","Medicine","Astrogation"],
  "Cunning":["Deception","Skulduggery","Streetwise","Survival"],
  "Willpower":["Discipline","Leadership","Vigilance"],
  "Presence":["Cool","Negotiation"]
};

let characters=[],selectedIndex=null;

// ========== Local Storage ==========
function saveToStorage(){localStorage.setItem("ffgChars",JSON.stringify(characters));}
function loadFromStorage(){const d=localStorage.getItem("ffgChars");if(d)characters=JSON.parse(d);}

// ========== UI Rendering ==========
function refreshCharList(){
  const list=document.getElementById("charList");
  list.innerHTML="";
  characters.forEach((c,i)=>{
    const div=document.createElement("div");
    div.className="char-item"+(i===selectedIndex?" active":"");
    div.textContent=c.name||"(Unnamed)";
    div.onclick=()=>openCharacter(i);
    list.appendChild(div);
  });
}
function renderStats(stats){
  const statGrid=document.getElementById("stats");
  statGrid.innerHTML="";
  ["Brawn","Agility","Intellect","Cunning","Willpower","Presence"].forEach(s=>{
    const div=document.createElement("div");
    div.className="stat";
    div.innerHTML=`<div>${s}</div><input type="number" min="0" value="${stats?.[s]||0}" data-stat="${s}"/>`;
    statGrid.appendChild(div);
  });
}
function renderSkills(skills){
  const skillList=document.getElementById("skillList");
  skillList.innerHTML="";
  ALL_SKILLS.forEach(skill=>{
    if(!skills[skill])skills[skill]={rank:0};
    const rank=skills[skill].rank||0;
    const attr=Object.keys(skillAttributes).find(a=>skillAttributes[a].includes(skill));
    const attrValue=(selectedIndex!==null && characters[selectedIndex].stats[attr])||0;
    const div=document.createElement("div");
    div.className="skill";
    div.innerHTML=`
      <span>${skill}</span>
      <input type="number" min="0" max="5" value="${rank}" data-skill="${skill}" style="width:40px"/>
      <div class="skillDice"></div>`;
    const input=div.querySelector("input");
    input.oninput=e=>{
      const val=parseInt(e.target.value)||0;
      skills[skill].rank=val;
      saveToStorage();
      renderSkills(skills);
    };
    const diceDiv=div.querySelector(".skillDice");
    let total=Math.max(rank,attrValue);
    let upgrade=Math.min(rank,attrValue);
    for(let i=0;i<total;i++){
      const dot=document.createElement("span");
      dot.className="dice-dot "+(upgrade>0?"proficiency":"ability");
      upgrade--;
      diceDiv.appendChild(dot);
    }
    skillList.appendChild(div);
  });
}

// ========== Character Editing ==========
function openCharacter(i){
  selectedIndex=i;
  const c=characters[i];
  document.getElementById("editorForm").style.display="block";
  document.getElementById("charNameDisplay").textContent=c.name;
  document.getElementById("name").value=c.name;
  document.getElementById("species").value=c.species;
  document.getElementById("career").value=c.career;
  document.getElementById("notes").value=c.notes||"";
  document.getElementById("wounds").value=c.wounds||0;
  document.getElementById("strain").value=c.strain||0;
  document.getElementById("soak").value=c.soak||0;
  document.getElementById("defense").value=c.defense||0;
  document.getElementById("gear").value=c.gear||"";
  renderStats(c.stats||{});
  renderSkills(c.skills||{});
  refreshCharList();
}

document.getElementById("saveBtn").onclick=()=>{
  if(selectedIndex===null)return;
  const c=characters[selectedIndex];
  c.name=document.getElementById("name").value;
  c.species=document.getElementById("species").value;
  c.career=document.getElementById("career").value;
  c.notes=document.getElementById("notes").value;
  c.wounds=+document.getElementById("wounds").value||0;
  c.strain=+document.getElementById("strain").value||0;
  c.soak=+document.getElementById("soak").value||0;
  c.defense=+document.getElementById("defense").value||0;
  c.gear=document.getElementById("gear").value;
  c.stats={};
  document.querySelectorAll("#stats input").forEach(i=>c.stats[i.dataset.stat]=+i.value||0);
  saveToStorage();
  refreshCharList();
};

// ========== Dice Roller ==========
function rollDice(){
  alert("Dice rolling works if images exist in /dice/ folder!");
}
document.getElementById("rollDiceBtn").onclick=rollDice;
document.getElementById("clearDiceBtn").onclick=()=>{document.getElementById("diceResult").innerHTML="";document.getElementById("netResult").innerHTML="";};

// ========== Utility Buttons ==========
document.getElementById("newBtn").onclick=()=>{
  const c={name:"New Character",species:"",career:"",notes:"",wounds:0,strain:0,soak:0,defense:0,gear:"",stats:{},skills:{}};
  characters.push(c);
  saveToStorage();
  refreshCharList();
};
document.getElementById("duplicateBtn").onclick=()=>{
  if(selectedIndex===null)return;
  const copy=JSON.parse(JSON.stringify(characters[selectedIndex]));
  copy.name+=" (Copy)";
  characters.push(copy);
  saveToStorage();
  refreshCharList();
};
document.getElementById("deleteBtn").onclick=()=>{
  if(selectedIndex===null)return;
  characters.splice(selectedIndex,1);
  selectedIndex=null;
  saveToStorage();
  refreshCharList();
  document.getElementById("editorForm").style.display="none";
  document.getElementById("charNameDisplay").textContent="— select a character —";
};
document.getElementById("exportBtn").onclick=()=>{
  const blob=new Blob([JSON.stringify(characters,null,2)],{type:"application/json"});
  const a=document.createElement("a");
  a.href=URL.createObjectURL(blob);
  a.download="characters.json";
  a.click();
};
document.getElementById("importBtn").onclick=()=>document.getElementById("importFile").click();
document.getElementById("importFile").onchange=e=>{
  const file=e.target.files[0];
  if(!file)return;
  const r=new FileReader();
  r.onload=()=>{
    characters=JSON.parse(r.result);
    saveToStorage();
    refreshCharList();
  };
  r.readAsText(file);
};
document.getElementById("seedBtn").onclick=()=>{
  characters=[{
    name:"Han Solo",species:"Human",career:"Smuggler",
    notes:"Never tell me the odds.",
    wounds:3,strain:2,soak:4,defense:1,gear:"DL-44, Millennium Falcon",
    stats:{Brawn:2,Agility:3,Intellect:2,Cunning:3,Willpower:2,Presence:3},
    skills:{Piloting:{rank:2},Deception:{rank:1},Mechanics:{rank:1}}
  }];
  saveToStorage(); refreshCharList();
};
document.getElementById("clearAllBtn").onclick=()=>{if(confirm("Clear all characters?")){characters=[];saveToStorage();refreshCharList();}};
document.getElementById("printBtn").onclick=()=>window.print();

// ========== INIT ==========
loadFromStorage();
refreshCharList();
</script>
</body>
</html>
