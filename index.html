<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>FFG Star Wars Character Tracker</title>
<link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&family=Inter:wght@300;400;600&display=swap" rel="stylesheet">
<style>
:root{
  --bg-overlay: rgba(2,6,12,0.55);
  --panel: rgba(10,18,28,0.72);
  --accent:#44d7ff;
  --muted:#98a0b3;
  --glass: rgba(255,255,255,0.03);
  --datapad:#061824;
  font-family: 'Inter', system-ui, -apple-system, 'Segoe UI', Roboto, 'Helvetica Neue', Arial;
}
html,body{height:100%;margin:0}
body{
  background: url('BACKGROUND_IMAGE_URL') no-repeat center center fixed;
  background-size: cover;
  color:#e6eef8;
  min-height:100vh;
}
body::before{
  content:""; position:fixed; inset:0;
  background:linear-gradient(180deg, rgba(0,0,0,0.45), rgba(0,0,0,0.65));
  z-index:-1;
}
.app{display:grid;grid-template-columns:320px 1fr;gap:18px;height:100vh;padding:20px;align-items:start}
.panel{background:var(--panel);border-radius:12px;padding:14px;box-shadow:0 10px 40px rgba(3,10,18,0.75);border:1px solid rgba(68,215,255,0.08)}
aside.panel{height:calc(100vh - 40px);overflow:auto}
main.panel{height:calc(100vh - 40px);overflow:auto;position:relative}
.datapad{background:linear-gradient(180deg, rgba(6,24,36,0.86), rgba(8,16,28,0.6));border:1px solid rgba(68,215,255,0.06);box-shadow:0 6px 30px rgba(0,120,160,0.12);border-radius:16px;padding:18px}
header{display:flex;gap:12px;align-items:center}
header .logo{width:52px;height:52px;border-radius:8px;background:linear-gradient(135deg,var(--accent),#8a6b44);display:flex;align-items:center;justify-content:center;font-weight:700;font-family:'Orbitron',sans-serif;color:#021;box-shadow:0 6px 18px rgba(68,215,255,0.06)}
h1{margin:0;font-size:16px}
.meta{font-size:12px;color:var(--muted)}
.character-list{margin-top:12px}
.char-item{display:flex;justify-content:space-between;align-items:center;padding:10px;border-radius:10px;background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));margin-bottom:8px;cursor:pointer}
.char-item.active{outline:2px solid rgba(68,215,255,0.08)}
.editor{display:flex;flex-direction:column;gap:12px}
.row{display:flex;gap:12px}
.col{flex:1}
label{font-size:12px;color:var(--muted);display:block;margin-bottom:6px}
input[type=text], input[type=number], select, textarea{width:100%;padding:8px;border-radius:8px;border:1px solid rgba(255,255,255,0.04);background:rgba(0,0,0,0.22);color:inherit}
textarea{resize:vertical}
.stat-grid{display:grid;grid-template-columns:repeat(6,1fr);gap:8px;margin-top:8px}
.stat{padding:8px;border-radius:8px;background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));text-align:center}
.stat input{width:56px;text-align:center;font-size:16px;background:transparent;border:0;color:inherit}
.skills, .gear-list{display:flex;flex-direction:column;gap:6px}
.skill{display:flex;justify-content:space-between;align-items:center;padding:8px;border-radius:8px;background:var(--glass)}
.dice-roller{margin-top:8px;padding:12px;background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));border-radius:8px}
.dice-controls{display:grid;grid-template-columns:repeat(4,1fr);gap:6px}
.dice-controls label{display:flex;flex-direction:column;align-items:center;font-size:12px}
.dice-result{background:rgba(0,0,0,0.25);padding:10px;border-radius:8px;min-height:48px}
.actions{display:flex;gap:8px;flex-wrap:wrap}
button{background:transparent;border:1px solid rgba(255,255,255,0.06);padding:8px 10px;border-radius:8px;color:inherit;cursor:pointer}
@media print{
  body::before{display:none}
  .app{padding:0}
  aside.panel, .controls, .character-list, .footer-actions, .import-input, button{display:none !important}
  main.panel{box-shadow:none;border:0;background:transparent;padding:0;height:auto}
  .print-sheet{display:block}
}
@media (max-width:900px){
  .app{grid-template-columns:1fr;grid-auto-rows:auto;padding:12px}
  aside.panel{height:auto}
}
.print-sheet{display:none;background:linear-gradient(180deg,#041423,#03121a);color:#e6eef8;padding:20px;border-radius:6px}
.sheet-grid{display:grid;grid-template-columns:1fr 1fr;gap:12px}
.sheet-header{display:flex;justify-content:space-between;align-items:center}
.sheet-section{background:rgba(255,255,255,0.03);padding:8px;border-radius:6px}
</style>
</head>
<body>

<div class="app">
  <aside class="panel datapad">
    <header>
      <div class="logo">SW</div>
      <div>
        <h1>FFG Character Tracker</h1>
        <div class="meta">Local-only · export/import JSON · printable</div>
      </div>
    </header>

    <div class="controls" style="margin-top:12px">
      <button id="newBtn">New</button>
      <button id="duplicateBtn">Duplicate</button>
      <button id="deleteBtn">Delete</button>
      <button id="exportBtn">Export</button>
      <button id="importBtn">Import</button>
      <input id="importFile" type="file" accept="application/json" style="display:none" />
    </div>

    <div class="character-list" id="charList" aria-label="Characters"></div>

    <div style="margin-top:12px;border-top:1px solid rgba(255,255,255,0.03);padding-top:12px">
      <div class="meta">Quick actions</div>
      <div style="margin-top:8px;display:flex;gap:8px">
        <button id="seedBtn">Load Sample</button>
        <button id="clearAllBtn">Clear All</button>
        <button id="printBtn">Print Sheet</button>
      </div>
    </div>
  </aside>

  <main class="panel datapad">
    <div style="display:flex;justify-content:space-between;align-items:center">
      <div>
        <div class="meta">Editing</div>
        <div id="charNameDisplay" style="font-size:20px">— select a character —</div>
      </div>
      <div class="actions">
        <button id="saveBtn">Save</button>
        <button id="downloadBtn">Download JSON</button>
      </div>
    </div>

    <div id="editorForm" style="display:none" class="editor">
      <div class="row">
        <div class="col">
          <label>Name</label>
          <input id="name" type="text" placeholder="Character name" />
        </div>
        <div style="width:190px">
          <label>Species</label>
          <input id="species" type="text" placeholder="Human / Twi'lek" />
        </div>
        <div style="width:220px">
          <label>Career / Role</label>
          <input id="career" type="text" placeholder="Smuggler / Bounty Hunter" />
        </div>
      </div>

      <div>
        <label>Motivation / Notes</label>
        <textarea id="notes" rows="3"></textarea>
      </div>

      <div>
        <label>Characteristics</label>
        <div class="stat-grid" id="stats"></div>
      </div>

      <div style="display:flex;gap:12px">
        <div style="flex:1">
          <label>Wounds</label>
          <input id="wounds" type="number" min="0" />
        </div>
        <div style="width:140px"><label>Strain</label><input id="strain" type="number" min="0" /></div>
        <div style="width:140px"><label>Soak</label><input id="soak" type="number" min="0" /></div>
        <div style="width:140px"><label>Defense</label><input id="defense" type="number" min="0" /></div>
      </div>

      <div>
        <label>Skills</label>
        <div class="skills" id="skillList"></div>

        <div style="display:flex;gap:8px;margin-top:8px">
          <select id="skillPicker" style="flex:1">
            <option value="">-- pick a skill --</option>
            <option>Piloting (Space)</option>
            <option>Piloting (Planetary)</option>
            <option>Astrogation</option>
            <option>Athletics</option>
            <option>Charm</option>
            <option>Coercion</option>
            <option>Computers</option>
            <option>Cool</option>
            <option>Coordination</option>
            <option>Deception</option>
            <option>Discipline</option>
            <option>Leadership</option>
            <option>Mechanics</option>
            <option>Medicine</option>
            <option>Negotiation</option>
            <option>Perception</option>
            <option>Resilience</option>
            <option>Skulduggery</option>
            <option>Stealth</option>
            <option>Streetwise</option>
            <option>Surveillance</option>
            <option>Underworld</option>
            <option>Vigilance</option>
          </select>
          <input id="newSkillRank" type="number" value="0" min="0" style="width:80px" />
          <button id="addSkillBtn">Add</button>
        </div>
      </div>

      <div>
        <label>Weapons & Gear</label>
        <textarea id="gear" rows="3" placeholder="Blaster pistol, Vibroknife, Armor, Grenades..."></textarea>
      </div>

      <div style="display:flex;gap:8px;align-items:center">
        <button id="gainXpBtn">+5 XP</button>
        <div class="meta">XP: <span id="xp">0</span></div>
      </div>

      <!-- Dice roller -->
      <div class="dice-roller">
        <div style="display:flex;justify-content:space-between;align-items:center">
          <div><strong>FFG Dice Roller</strong><div class="meta" style="font-size:11px">Ability / Proficiency / Difficulty / Challenge / Boost / Setback / Force</div></div>
          <div style="display:flex;gap:8px">
            <button id="clearDiceBtn">Clear</button>
            <button id="rollDiceBtn">Roll</button>
          </div>
        </div>
        <div class="dice-controls">
          <label>Ability<input type="number" min="0" value="0" id="diceAbility"></label>
          <label>Proficiency<input type="number" min="0" value="0" id="diceProficiency"></label>
          <label>Difficulty<input type="number" min="0" value="0" id="diceDifficulty"></label>
          <label>Challenge<input type="number" min="0" value="0" id="diceChallenge"></label>
          <label>Boost<input type="number" min="0" value="0" id="diceBoost"></label>
          <label>Setback<input type="number" min="0" value="0" id="diceSetback"></label>
          <label>Force<input type="number" min="0" value="0" id="diceForce"></label>
        </div>
        <div class="dice-result" id="diceResult"></div>
      </div>
    </div>
  </main>
</div>

<div class="print-sheet" id="printSheet">
  <h2 id="printName">Character Sheet</h2>
  <div class="sheet-grid">
    <div class="sheet-section" id="sheetStats"></div>
    <div class="sheet-section" id="sheetSkills"></div>
  </div>
</div>

<script>
// -------- Character Management --------
let characters = JSON.parse(localStorage.getItem("ffgCharacters") || "[]");
let selectedIndex = null;

const charList = document.getElementById("charList");
const editorForm = document.getElementById("editorForm");

function refreshCharList(){
  charList.innerHTML="";
  characters.forEach((c,i)=>{
    const li = document.createElement("div");
    li.className="char-item"+(i===selectedIndex?" active":"");
    li.textContent=c.name||"Unnamed Character";
    li.onclick=()=>openCharacter(i);
    charList.appendChild(li);
  });
  localStorage.setItem("ffgCharacters", JSON.stringify(characters));
}

function openCharacter(index){
  selectedIndex=index;
  const c = characters[index];
  document.getElementById("charNameDisplay").textContent=c.name||"Unnamed Character";
  editorForm.style.display="flex";
  document.getElementById("name").value=c.name;
  document.getElementById("species").value=c.species||"";
  document.getElementById("career").value=c.career||"";
  document.getElementById("notes").value=c.notes||"";
  document.getElementById("wounds").value=c.wounds||0;
  document.getElementById("strain").value=c.strain||0;
  document.getElementById("soak").value=c.soak||0;
  document.getElementById("defense").value=c.defense||0;
  document.getElementById("xp").textContent=c.xp||0;

  renderStats(c.stats||{});
  renderSkills(c.skills||{});
  document.getElementById("gear").value=c.gear||"";
  refreshCharList();
}

function saveCharacter(){
  if(selectedIndex===null) return;
  const c = characters[selectedIndex];
  c.name=document.getElementById("name").value;
  c.species=document.getElementById("species").value;
  c.career=document.getElementById("career").value;
  c.notes=document.getElementById("notes").value;
  c.wounds=parseInt(document.getElementById("wounds").value)||0;
  c.strain=parseInt(document.getElementById("strain").value)||0;
  c.soak=parseInt(document.getElementById("soak").value)||0;
  c.defense=parseInt(document.getElementById("defense").value)||0;
  c.xp=parseInt(document.getElementById("xp").textContent)||0;
  c.stats=readStats();
  c.skills=readSkills();
  c.gear=document.getElementById("gear").value;
  refreshCharList();
}

// Add / Duplicate / Delete
document.getElementById("newBtn").onclick=()=>{
  characters.push({name:"New Character", stats:{Brawn:0,Agility:0,Intellect:0,Cunning:0,Willpower:0,Presence:0},skills:{},xp:0,wounds:0,strain:0,soak:0,defense:0,gear:""});
  openCharacter(characters.length-1);
};
document.getElementById("duplicateBtn").onclick=()=>{
  if(selectedIndex===null) return;
  characters.push(JSON.parse(JSON.stringify(characters[selectedIndex])));
  openCharacter(characters.length-1);
};
document.getElementById("deleteBtn").onclick=()=>{
  if(selectedIndex===null) return;
  characters.splice(selectedIndex,1);
  selectedIndex=null;
  editorForm.style.display="none";
  document.getElementById("charNameDisplay").textContent="— select a character —";
  refreshCharList();
};

// Export / Import
document.getElementById("exportBtn").onclick=()=>{
  const dataStr = JSON.stringify(characters,null,2);
  const blob = new Blob([dataStr],{type:"application/json"});
  const url = URL.createObjectURL(blob);
  const a = document.createElement("a");
  a.href=url; a.download="ffg_characters.json"; a.click();
};
document.getElementById("importBtn").onclick=()=>document.getElementById("importFile").click();
document.getElementById("importFile").onchange=function(e){
  const file = e.target.files[0];
  if(!file) return;
  const reader = new FileReader();
  reader.onload=function(evt){
    try{
      characters=JSON.parse(evt.target.result);
      refreshCharList();
      selectedIndex=null;
      editorForm.style.display="none";
    }catch(err){alert("Invalid JSON")}
  };
  reader.readAsText(file);
};

// Sample / Clear / Print
document.getElementById("seedBtn").onclick=()=>{
  characters=[{name:"Luke Skywalker",species:"Human",career:"Jedi",stats:{Brawn:2,Agility:3,Intellect:3,Cunning:2,Willpower:3,Presence:2},skills:{"Lightsaber":3,"Piloting (Space)":2},gear:"Lightsaber, X-Wing",xp:10,wounds:0,strain:0,soak:1,defense:1}];
  openCharacter(0);
};
document.getElementById("clearAllBtn").onclick=()=>{
  characters=[]; selectedIndex=null; editorForm.style.display="none"; document.getElementById("charNameDisplay").textContent="— select a character —"; refreshCharList();
};
document.getElementById("printBtn").onclick=()=>printSheet();

// Stats / Skills helpers
function renderStats(stats){
  const statGrid=document.getElementById("stats");
  statGrid.innerHTML="";
  ["Brawn","Agility","Intellect","Cunning","Willpower","Presence"].forEach(s=>{
    const div=document.createElement("div");
    div.className="stat";
    div.innerHTML=`<div>${s}</div><input type="number" min="0" value="${stats[s]||0}" data-stat="${s}" />`;
    statGrid.appendChild(div);
  });
}
function readStats(){
  const inputs=document.querySelectorAll("#stats input");
  const s={};
  inputs.forEach(i=>s[i.dataset.stat]=parseInt(i.value)||0);
  return s;
}
function renderSkills(skills){
  const skillList=document.getElementById("skillList");
  skillList.innerHTML="";
  Object.keys(skills).forEach(k=>{
    const div=document.createElement("div"); div.className="skill";
    div.textContent=`${k} : ${skills[k]}`;
    div.onclick=()=>{delete skills[k]; renderSkills(skills);}
    skillList.appendChild(div);
  });
}
function readSkills(){
  const skills={};
  document.querySelectorAll("#skillList .skill").forEach(s=>{
    const parts=s.textContent.split(":");
    if(parts.length===2) skills[parts[0].trim()]=parseInt(parts[1].trim())||0;
  });
  return skills;
}
document.getElementById("addSkillBtn").onclick=()=>{
  if(selectedIndex===null) return;
  const sk=document.getElementById("skillPicker").value;
  const rank=parseInt(document.getElementById("newSkillRank").value)||0;
  if(!sk) return;
  const c=characters[selectedIndex];
  c.skills[c.skills||{}]=c.skills||{};
  c.skills[sk]=rank;
  renderSkills(c.skills);
};

// XP buttons
document.getElementById("gainXpBtn").onclick=()=>{
  if(selectedIndex===null) return;
  const c=characters[selectedIndex]; c.xp=(c.xp||0)+5;
  document.getElementById("xp").textContent=c.xp;
};

// Download single character JSON
document.getElementById("downloadBtn").onclick=()=>{
  if(selectedIndex===null) return;
  const dataStr = JSON.stringify(characters[selectedIndex],null,2);
  const blob = new Blob([dataStr],{type:"application/json"});
  const url = URL.createObjectURL(blob);
  const a=document.createElement("a"); a.href=url; a.download=characters[selectedIndex].name+"_sheet.json"; a.click();
};

// -------- Dice Roller --------
function rollDie(sidesArray){return sidesArray[Math.floor(Math.random()*sidesArray.length)];}

document.getElementById("rollDiceBtn").onclick=()=>{
  const ability=parseInt(document.getElementById("diceAbility").value)||0;
  const proficiency=parseInt(document.getElementById("diceProficiency").value)||0;
  const difficulty=parseInt(document.getElementById("diceDifficulty").value)||0;
  const challenge=parseInt(document.getElementById("diceChallenge").value)||0;
  const boost=parseInt(document.getElementById("diceBoost").value)||0;
  const setback=parseInt(document.getElementById("diceSetback").value)||0;
  const force=parseInt(document.getElementById("diceForce").value)||0;
  // Dice faces simplified for demonstration
  const faces={ability:["Success","Success","Advantage","Advantage","Success+Adv","Blank","Advantage","Success"], proficiency:["Success","Success","Success+Adv","Advantage","Advantage","Triumph","Success","Blank"],difficulty:["Failure","Failure","Threat","Threat","Failure+Threat","Blank","Threat","Threat"], challenge:["Failure","Failure","Failure+Threat","Threat","Threat","Despair","Blank","Threat"], boost:["Success","Advantage","Blank","Advantage"], setback:["Failure","Threat","Blank","Threat"], force:["Dark","Dark","Dark","Dark","Light","Light","Light","Light"]};
  let results=[];
  function addDie(n,type){for(let i=0;i<n;i++)results.push(rollDie(faces[type]));}
  addDie(ability,"ability"); addDie(proficiency,"proficiency");
  addDie(difficulty,"difficulty"); addDie(challenge,"challenge");
  addDie(boost,"boost"); addDie(setback,"setback"); addDie(force,"force");
  document.getElementById("diceResult").textContent=results.join(" | ");
};
document.getElementById("clearDiceBtn").onclick=()=>document.getElementById("diceResult").textContent="";

// -------- Print Sheet --------
function printSheet(){
  if(selectedIndex===null) return;
  const c=characters[selectedIndex];
  document.getElementById("printName").textContent=c.name;
  document.getElementById("sheetStats").innerHTML="<strong>Stats</strong><br>"+JSON.stringify(c.stats,null,2);
  document.getElementById("sheetSkills").innerHTML="<strong>Skills / Gear / Notes</strong><br>Skills:"+JSON.stringify(c.skills,null,2)+"<br>Gear:"+c.gear+"<br>Notes:"+c.notes;
  window.print();
}

// Initial render
refreshCharList();
</script>
</body>
</html>
